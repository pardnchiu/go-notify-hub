![cover](./cover.png)

> [!NOTE]
> This README was generated by [SKILL](https://github.com/pardnchiu/skill-readme-generate), get the ZH version from [here](./README.zh.md).

# go-notify-hub

[![pkg](https://pkg.go.dev/badge/github.com/pardnchiu/go-notify-hub.svg)](https://pkg.go.dev/github.com/pardnchiu/go-notify-hub)
[![card](https://goreportcard.com/badge/github.com/pardnchiu/go-notify-hub)](https://goreportcard.com/report/github.com/pardnchiu/go-notify-hub)
[![license](https://img.shields.io/github/license/pardnchiu/go-notify-hub)](LICENSE)
[![version](https://img.shields.io/github/v/tag/pardnchiu/go-notify-hub?label=release)](https://github.com/pardnchiu/go-notify-hub/releases)

> Multi-platform notification API service integrating Discord Webhook, Slack Webhook, LINE Bot, and Email with a unified RESTful API for managing all notification channels.

## Table of Contents

- [Features](#features)
- [Architecture](#architecture)
- [Installation](#installation)
- [Configuration](#configuration)
- [Usage](#usage)
- [API Reference](#api-reference)
- [License](#license)
- [Author](#author)
- [Stars](#stars)

## Features

- **Multi-platform Integration**: Support for Discord Webhook, Slack Webhook, LINE Bot, and Email
- **Unified API**: Manage all notification channels through RESTful API
- **Channel Management**: Dynamically add, remove, and list registered channels
- **LINE Bot Interaction**: Automatic handling of follow/unfollow events and batch broadcasting
- **Email Delivery**: Single and bulk email sending with TLS/STARTTLS support
- **Rich Message Formatting**: Support for embeds, attachments, fields, images, and more
- **Concurrency Safe**: Uses RWMutex to protect shared data structures

## Architecture

```
cmd/
└── api/
    └── main.go              # Application entry point
internal/
├── bot/
│   ├── dicord/              # Discord Bot handler logic
│   ├── line/                # LINE Bot handler logic
│   └── handler/             # Bot request routing
├── channel/
│   ├── discord/             # Discord Webhook management
│   └── slack/               # Slack Webhook management
├── database/
│   ├── sqlite.go            # SQLite connection management
│   ├── insertUser.go        # Insert user
│   ├── deleteUser.go        # Delete user
│   └── selectUserLinebot.go # Query LINE Bot users
├── email/
│   ├── email.go             # Email client initialization
│   ├── send.go              # Send single email
│   └── bulk.go              # Send bulk emails
└── utils/
    └── utils.go             # Shared utility functions
```

## Installation

### Build from Source

```bash
# Clone the repository
git clone https://github.com/pardnchiu/go-notify-hub.git
cd go-notify-hub

# Install dependencies
go mod download

# Build the application
go build -o go-notify-hub cmd/api/main.go
```

### Using Docker

```bash
# Using Docker Compose
docker-compose up -d

# Or build Docker image manually
docker build -t go-notify-hub .
docker run -p 8080:8080 \
  -v $(pwd)/data:/data \
  --env-file .env \
  go-notify-hub
```

## Configuration

Create a `.env` file in the project root:

```bash
# Database path (optional, default: ~/.go-notify-hub/database.db)
DB_PATH=/path/to/database.db

# Discord Bot (optional)
DISCORD_BOT_TOKEN=your_discord_bot_token

# LINE Bot (optional)
LINEBOT_SECRET=your_linebot_channel_secret
LINEBOT_TOKEN=your_linebot_channel_access_token

# Email SMTP (optional)
EMAIL_SMTP_HOST=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_FROM=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
```

### Environment Variables

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `DB_PATH` | SQLite database file path | No | `~/.go-notify-hub/database.db` |
| `DISCORD_BOT_TOKEN` | Discord Bot Token | No | - |
| `LINEBOT_SECRET` | LINE Bot Channel Secret | No | - |
| `LINEBOT_TOKEN` | LINE Bot Channel Access Token | No | - |
| `EMAIL_SMTP_HOST` | SMTP server host | No | - |
| `EMAIL_SMTP_PORT` | SMTP server port | No | `587` |
| `EMAIL_FROM` | Sender email address | No | - |
| `EMAIL_PASSWORD` | Email password or app password | No | - |

## Usage

### Start the Service

```bash
# Direct execution
./go-notify-hub

# Or using go run
go run cmd/api/main.go
```

The service starts on `:8080` by default.

### Discord Webhook Examples

```bash
# Add Discord channel
curl -X POST http://localhost:8080/discord/add \
  -H "Content-Type: application/json" \
  -d '{
    "name": "alerts",
    "webhook": "https://discord.com/api/webhooks/..."
  }'

# Send message to Discord
curl -X POST http://localhost:8080/discord/alerts \
  -H "Content-Type: application/json" \
  -d '{
    "content": "Hello from go-notify-hub!",
    "embeds": [{
      "title": "System Notification",
      "description": "Service started successfully",
      "color": 3447003
    }]
  }'

# List all Discord channels
curl http://localhost:8080/discord/list

# Delete Discord channel
curl -X DELETE http://localhost:8080/discord/alerts
```

### Slack Webhook Examples

```bash
# Add Slack channel
curl -X POST http://localhost:8080/slack/add \
  -H "Content-Type: application/json" \
  -d '{
    "name": "monitoring",
    "webhook": "https://hooks.slack.com/services/..."
  }'

# Send message to Slack
curl -X POST http://localhost:8080/slack/monitoring \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Server CPU usage is high",
    "attachments": [{
      "color": "danger",
      "fields": [{
        "title": "CPU Usage",
        "value": "95%",
        "short": true
      }]
    }]
  }'
```

### LINE Bot Examples

```bash
# Webhook endpoint (called by LINE Platform)
# POST http://localhost:8080/linebot/webhook

# Broadcast message to all followers
curl -X POST http://localhost:8080/linebot/send/all \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [{
      "type": "text",
      "text": "Important notice: System maintenance tonight at 22:00"
    }]
  }'
```

### Email Examples

```bash
# Send single email
curl -X POST http://localhost:8080/email/send \
  -H "Content-Type: application/json" \
  -d '{
    "to": ["user@example.com"],
    "subject": "Test Email",
    "body": "This is a test email.",
    "html": true
  }'

# Send bulk emails
curl -X POST http://localhost:8080/email/send/bulk \
  -H "Content-Type: application/json" \
  -d '{
    "recipients": [
      {"email": "user1@example.com", "name": "User 1"},
      {"email": "user2@example.com", "name": "User 2"}
    ],
    "subject": "Bulk Notification",
    "body": "Dear {{.Name}}, this is your personalized message.",
    "html": true
  }'
```

## API Reference

### Discord API

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/discord/list` | List all registered Discord channels |
| `POST` | `/discord/:channelName` | Send message to specified channel |
| `POST` | `/discord/add` | Add Discord channel |
| `DELETE` | `/discord/:channelName` | Delete Discord channel |

#### POST /discord/add

**Request Body:**
```json
{
  "name": "channel-name",
  "webhook": "https://discord.com/api/webhooks/..."
}
```

**Response:**
```json
{
  "message": "Channel added successfully"
}
```

#### POST /discord/:channelName

**Request Body:**
```json
{
  "content": "Message content",
  "username": "Custom Bot Name",
  "avatar_url": "https://example.com/avatar.png",
  "embeds": [{
    "title": "Embed Title",
    "description": "Embed Description",
    "color": 3447003,
    "fields": [{
      "name": "Field Name",
      "value": "Field Value",
      "inline": true
    }],
    "image": {
      "url": "https://example.com/image.png"
    },
    "timestamp": "2026-01-01T00:00:00Z"
  }]
}
```

### Slack API

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/slack/list` | List all registered Slack channels |
| `POST` | `/slack/:channelName` | Send message to specified channel |
| `POST` | `/slack/add` | Add Slack channel |
| `DELETE` | `/slack/:channelName` | Delete Slack channel |

#### POST /slack/add

**Request Body:**
```json
{
  "name": "channel-name",
  "webhook": "https://hooks.slack.com/services/..."
}
```

#### POST /slack/:channelName

**Request Body:**
```json
{
  "text": "Message text",
  "attachments": [{
    "color": "good",
    "title": "Attachment Title",
    "text": "Attachment Text",
    "fields": [{
      "title": "Field Title",
      "value": "Field Value",
      "short": true
    }]
  }]
}
```

### LINE Bot API

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/linebot/webhook` | LINE Platform Webhook endpoint |
| `POST` | `/linebot/send/all` | Broadcast message to all followers |

#### POST /linebot/send/all

**Request Body:**
```json
{
  "messages": [{
    "type": "text",
    "text": "Broadcast message content"
  }]
}
```

**Supported Message Types:**
- `text`: Text message
- `image`: Image message
- `video`: Video message
- `audio`: Audio message
- `location`: Location message
- `sticker`: Sticker message
- `template`: Template message
- `flex`: Flex message

### Email API

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/email/send` | Send single email |
| `POST` | `/email/send/bulk` | Send bulk emails |

#### POST /email/send

**Request Body:**
```json
{
  "to": ["recipient@example.com"],
  "cc": ["cc@example.com"],
  "bcc": ["bcc@example.com"],
  "subject": "Email Subject",
  "body": "Email body content",
  "html": true
}
```

#### POST /email/send/bulk

**Request Body:**
```json
{
  "recipients": [
    {"email": "user1@example.com", "name": "User 1"},
    {"email": "user2@example.com", "name": "User 2"}
  ],
  "subject": "Email Subject",
  "body": "Hello {{.Name}}, this is your personalized message.",
  "html": true
}
```

**Template Variables:**
- `{{.Name}}`: Recipient name
- `{{.Email}}`: Recipient email

### Database API

#### SQLite

**Exported Types:**

```go
type SQLite struct {
    // Internal fields
}
```

**Methods:**

| Method | Signature | Description |
|--------|-----------|-------------|
| `NewSQLite` | `func NewSQLite(dbPath string) (*SQLite, error)` | Create new SQLite connection |
| `Close` | `func (s *SQLite) Close() error` | Close database connection |
| `InsertUser` | `func (s *SQLite) InsertUser(ctx context.Context, uid string) error` | Insert user (LINE Bot follower) |
| `DeleteUser` | `func (s *SQLite) DeleteUser(ctx context.Context, uid string) error` | Delete user (LINE Bot unfollower) |
| `SelectUserLinebot` | `func (s *SQLite) SelectUserLinebot(ctx context.Context) ([]string, error)` | Query all LINE Bot user IDs |

### Utility Functions

**Exported Functions:**

| Function | Signature | Description |
|----------|-----------|-------------|
| `GetPath` | `func GetPath(arg ...string) (string, error)` | Get configuration file path |
| `GetFile` | `func GetFile(arg ...string) (map[string]string, error)` | Read JSON configuration file |
| `WriteJSON` | `func WriteJSON(path string, data map[string]string) error` | Write JSON configuration file |
| `ResponseError` | `func ResponseError(c *gin.Context, status int, err error, fn, message string)` | Standardized error response |
| `CheckChannelPayload` | `func CheckChannelPayload(req ChannelPayload, regexName, regexWebhook *regexp.Regexp) error` | Validate channel request payload |

## License

This project is licensed under the [MIT LICENSE](LICENSE).

## Author

<img src="https://avatars.githubusercontent.com/u/25631760" align="left" width="96" height="96" style="margin-right: 0.5rem;">

<h4 style="padding-top: 0">邱敬幃 Pardn Chiu</h4>

<a href="mailto:dev@pardn.io" target="_blank">
<img src="https://pardn.io/image/email.svg" width="48" height="48">
</a> <a href="https://linkedin.com/in/pardnchiu" target="_blank">
<img src="https://pardn.io/image/linkedin.svg" width="48" height="48">
</a>

## Stars

[![Star](https://api.star-history.com/svg?repos=pardnchiu/go-notify-hub&type=Date)](https://www.star-history.com/#pardnchiu/go-notify-hub&Date)

***

©️ 2026 [邱敬幃 Pardn Chiu](https://linkedin.com/in/pardnchiu)
