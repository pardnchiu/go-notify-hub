# goNotify

> [!NOTE]
> This README was generated by Claude Code, get the ZH version from [here](./README.zh.md).

[![pkg](https://pkg.go.dev/badge/github.com/pardnchiu/goNotify.svg)](https://pkg.go.dev/github.com/pardnchiu/goNotify)
[![card](https://goreportcard.com/badge/github.com/pardnchiu/goNotify)](https://goreportcard.com/report/github.com/pardnchiu/goNotify)
[![license](https://img.shields.io/github/license/pardnchiu/goNotify)](LICENSE)
[![version](https://img.shields.io/github/v/tag/pardnchiu/goNotify?label=release)](https://github.com/pardnchiu/goNotify/releases)

> Lightweight webhook notification API service supporting Discord and Slack multi-channel management and message delivery.

## Features

- **Multi-platform Support**: Integrates Discord and Slack webhook APIs
- **Dynamic Channel Management**: Add, delete, and query channel configurations at runtime
- **Rich Message Formatting**: Supports embeds, attachments, fields, images, footers, and more
- **RESTful API**: Clean HTTP endpoint design for easy integration
- **Persistent Configuration**: Automatically saves channel configurations as JSON files
- **Concurrency Safe**: Uses RWMutex to protect shared data structures

## Installation

### Prerequisites

- Go 1.25.1 or higher
- Git

### Download and Install

```bash
# Clone the repository
git clone https://github.com/pardnchiu/goNotify.git
cd goNotify

# Download dependencies
go mod download

# Build and run
go run cmd/api/main.go
```

The service will start on port `:8080`.

## Usage

### Discord Operations

#### 1. Add Discord Channel

```bash
curl -X POST http://localhost:8080/discord/add \
  -H "Content-Type: application/json" \
  -d '{
    "datas": [
      {
        "name": "alerts",
        "webhook": "https://discord.com/api/webhooks/123456789/abcdefg"
      }
    ]
  }'
```

#### 2. Send Discord Message

```bash
curl -X POST http://localhost:8080/discord/alerts \
  -H "Content-Type: application/json" \
  -d '{
    "title": "System Alert",
    "description": "Server CPU usage is high",
    "color": "#FF5733",
    "fields": [
      {
        "name": "Server",
        "value": "web-01",
        "inline": true
      },
      {
        "name": "CPU Usage",
        "value": "95%",
        "inline": true
      }
    ],
    "footer": {
      "text": "Monitoring System",
      "icon_url": "https://example.com/icon.png"
    }
  }'
```

#### 3. List Discord Channels

```bash
curl http://localhost:8080/discord/list
```

Response example:
```json
{
  "alerts": "https://discord.com/api/webhooks/123456789/abcdefg",
  "notifications": "https://discord.com/api/webhooks/987654321/hijklmn"
}
```

#### 4. Delete Discord Channel

```bash
curl -X DELETE http://localhost:8080/discord/alerts
```

### Slack Operations

#### 1. Add Slack Channel

```bash
curl -X POST http://localhost:8080/slack/add \
  -H "Content-Type: application/json" \
  -d '{
    "datas": [
      {
        "name": "deployments",
        "webhook": "https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX"
      }
    ]
  }'
```

#### 2. Send Slack Message

```bash
curl -X POST http://localhost:8080/slack/deployments \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Deployment completed",
    "title": "Production Deployment",
    "description": "Version v1.2.3 successfully deployed to production",
    "color": "good",
    "fields": [
      {
        "title": "Environment",
        "value": "Production",
        "short": true
      },
      {
        "title": "Version",
        "value": "v1.2.3",
        "short": true
      }
    ],
    "footer": {
      "text": "CI/CD Pipeline"
    }
  }'
```

#### 3. List Slack Channels

```bash
curl http://localhost:8080/slack/list
```

#### 4. Delete Slack Channel

```bash
curl -X DELETE http://localhost:8080/slack/deployments
```

## API Reference

### Discord API

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/discord/list` | GET | Get all Discord channel configurations |
| `/discord/:channelName` | POST | Send message to specified Discord channel |
| `/discord/add` | POST | Add one or more Discord channels |
| `/discord/:channelName` | DELETE | Delete specified Discord channel |

#### Discord Message Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `title` | string | Yes | Embed title |
| `description` | string | Yes | Embed content description |
| `url` | string | No | Title hyperlink |
| `color` | string | No | Sidebar color (hex format, e.g. `#FF5733`) |
| `timestamp` | string | No | ISO8601 timestamp |
| `image` | string | No | Large image URL |
| `thumbnail` | string | No | Thumbnail URL |
| `fields` | array | No | Field array (`name`, `value`, `inline`) |
| `footer` | object | No | Footer object (`text`, `icon_url`) |
| `author` | object | No | Author object (`name`, `url`, `icon_url`) |
| `username` | string | No | Bot display name |
| `avatar_url` | string | No | Bot avatar URL |

### Slack API

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/slack/list` | GET | Get all Slack channel configurations |
| `/slack/:channelName` | POST | Send message to specified Slack channel |
| `/slack/add` | POST | Add one or more Slack channels |
| `/slack/:channelName` | DELETE | Delete specified Slack channel |

#### Slack Message Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `text` | string | Yes | Message text (notification and fallback) |
| `title` | string | No | Attachment title |
| `title_link` | string | No | Title hyperlink |
| `description` | string | No | Attachment content |
| `pretext` | string | No | Text above attachment |
| `color` | string | No | Sidebar color (`good`/`warning`/`danger` or hex) |
| `timestamp` | int64 | No | Unix timestamp |
| `image` | string | No | Large image URL |
| `thumbnail` | string | No | Thumbnail URL (right side) |
| `fields` | array | No | Field array (`title`, `value`, `short`) |
| `footer` | object | No | Footer object (`text`, `icon_url`) |
| `username` | string | No | Bot display name |
| `icon_emoji` | string | No | Bot icon emoji (e.g. `:rocket:`) |
| `icon_url` | string | No | Bot avatar URL |
| `channel` | string | No | Target channel (e.g. `#channel` or `@user`) |
| `thread_ts` | string | No | Thread timestamp (for replies) |

## Project Structure

```
goNotify/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ main.go              # Application entry point
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ channel/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discord.go           # Discord webhook client
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ slack.go             # Slack webhook client
‚îÇ   ‚îú‚îÄ‚îÄ handler/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discord.go           # Discord handler initialization
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discordAdd.go        # Add Discord channel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discordSend.go       # Send Discord message
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discordDelete.go     # Delete Discord channel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ slack.go             # Slack handler initialization
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ slackAdd.go          # Add Slack channel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ slackSend.go         # Send Slack message
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ slackDelete.go       # Delete Slack channel
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ utils.go             # Shared utilities (file I/O, JSON handling)
‚îú‚îÄ‚îÄ json/
‚îÇ   ‚îú‚îÄ‚îÄ discord_channel.json     # Discord channel config (auto-generated)
‚îÇ   ‚îî‚îÄ‚îÄ slack_channel.json       # Slack channel config (auto-generated)
‚îú‚îÄ‚îÄ go.mod                       # Go module definition
‚îî‚îÄ‚îÄ go.sum                       # Dependency version lock
```

## Architecture

```mermaid
graph TB
    A[Client] -->|HTTP Request| B[Gin Router]
    B --> C{Route Dispatch}
    
    C -->|/discord/*| D[Discord Handler]
    C -->|/slack/*| E[Slack Handler]
    
    D --> D1[List]
    D --> D2[Add]
    D --> D3[Send]
    D --> D4[Delete]
    
    E --> E1[List]
    E --> E2[Add]
    E --> E3[Send]
    E --> E4[Delete]
    
    D3 --> F[Discord Channel]
    E3 --> G[Slack Channel]
    
    F -->|Webhook POST| H[Discord API]
    G -->|Webhook POST| I[Slack API]
    
    D2 --> J[Utils]
    D4 --> J
    E2 --> J
    E4 --> J
    
    J -->|Read/Write| K[(JSON Files)]
    
    style A fill:#e1f5ff
    style H fill:#5865f2
    style I fill:#611f69
    style K fill:#fff4e6
```

## Use Cases

### 1. CI/CD Pipeline Notifications

Send status updates during deployment workflows:

```bash
# Deployment started
curl -X POST http://localhost:8080/slack/cicd \
  -d '{"text": "üöÄ Starting production deployment", "color": "warning"}'

# Deployment succeeded
curl -X POST http://localhost:8080/slack/cicd \
  -d '{"text": "‚úÖ Deployment completed", "color": "good"}'
```

### 2. System Monitoring Alerts

Send alerts when server metrics are abnormal:

```bash
curl -X POST http://localhost:8080/discord/monitoring \
  -d '{
    "title": "üî¥ CPU Alert",
    "description": "Server load is too high",
    "color": "#FF0000",
    "fields": [
      {"name": "Host", "value": "web-01", "inline": true},
      {"name": "CPU", "value": "98%", "inline": true}
    ]
  }'
```

### 3. Application Error Notifications

Capture and send application errors:

```go
func notifyError(err error) {
    payload := map[string]interface{}{
        "title":       "Application Error",
        "description": err.Error(),
        "color":       "#FF5733",
    }
    
    // Send to Discord
    http.Post("http://localhost:8080/discord/errors", 
        "application/json", 
        bytes.NewBuffer(jsonPayload))
}
```

## License

MIT License

## Author

<img src="https://avatars.githubusercontent.com/u/25631760" align="left" width="96" height="96" style="margin-right: 0.5rem;">

<h4 style="padding-top: 0">ÈÇ±Êï¨ÂπÉ Pardn Chiu</h4>

<a href="mailto:dev@pardn.io" target="_blank">
<img src="https://pardn.io/image/email.svg" width="48" height="48">
</a> <a href="https://linkedin.com/in/pardnchiu" target="_blank">
<img src="https://pardn.io/image/linkedin.svg" width="48" height="48">
</a>

## Stars

[![Star](https://api.star-history.com/svg?repos=pardnchiu/goNotify&type=Date)](https://www.star-history.com/#pardnchiu/goNotify&Date)

***

¬©Ô∏è 2026 [ÈÇ±Êï¨ÂπÉ Pardn Chiu](https://linkedin.com/in/pardnchiu)
