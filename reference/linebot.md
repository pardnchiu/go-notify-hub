# Linebot Doc
> generated by claude sonnet 4.5
> not tested, just saving for reference

```go
package bot

import (
	"fmt"

	"github.com/line/line-bot-sdk-go/v8/linebot"
)

// LinebotRequest 包含所有可傳送的訊息類型參數
type LinebotRequest struct {
	// Text Message
	Text string `json:"text,omitempty"`

	// Image Message
	ImageOriginalURL string `json:"image_original_url,omitempty"`
	ImagePreviewURL  string `json:"image_preview_url,omitempty"`

	// Video Message
	VideoOriginalURL string `json:"video_original_url,omitempty"`
	VideoPreviewURL  string `json:"video_preview_url,omitempty"`

	// Audio Message
	AudioOriginalURL string `json:"audio_original_url,omitempty"`
	AudioDuration    int    `json:"audio_duration,omitempty"` // 毫秒

	// Location Message
	LocationTitle     string  `json:"location_title,omitempty"`
	LocationAddress   string  `json:"location_address,omitempty"`
	LocationLatitude  float64 `json:"location_latitude,omitempty"`
	LocationLongitude float64 `json:"location_longitude,omitempty"`

	// Sticker Message
	StickerPackageID string `json:"sticker_package_id,omitempty"`
	StickerID        string `json:"sticker_id,omitempty"`

	// Flex Message
	FlexAltText  string                 `json:"flex_alt_text,omitempty"`
	FlexContents map[string]interface{} `json:"flex_contents,omitempty"`

	// Template Message
	TemplateAltText string           `json:"template_alt_text,omitempty"`
	Template        *LinebotTemplate `json:"template,omitempty"`

	// Imagemap Message
	ImagemapBaseURL  string                `json:"imagemap_base_url,omitempty"`
	ImagemapAltText  string                `json:"imagemap_alt_text,omitempty"`
	ImagemapBaseSize *LinebotImagemapSize  `json:"imagemap_base_size,omitempty"`
	ImagemapActions  []LinebotImagemapArea `json:"imagemap_actions,omitempty"`

	// Quick Reply (可附加到任何訊息)
	QuickReply *LinebotQuickReply `json:"quick_reply,omitempty"`

	// Sender (可自訂傳送者資訊)
	Sender *LinebotSender `json:"sender,omitempty"`
}

// Template 相關結構
type LinebotTemplate struct {
	// Buttons Template
	ButtonsText         string          `json:"buttons_text,omitempty"`
	ButtonsThumbnailURL string          `json:"buttons_thumbnail_url,omitempty"`
	ButtonsImageAspect  string          `json:"buttons_image_aspect,omitempty"`   // rectangle, square
	ButtonsImageSize    string          `json:"buttons_image_size,omitempty"`     // cover, contain
	ButtonsImageBgColor string          `json:"buttons_image_bg_color,omitempty"` // #RRGGBB
	ButtonsTitle        string          `json:"buttons_title,omitempty"`
	ButtonsActions      []LinebotAction `json:"buttons_actions,omitempty"`

	// Confirm Template
	ConfirmText    string          `json:"confirm_text,omitempty"`
	ConfirmActions []LinebotAction `json:"confirm_actions,omitempty"` // 限制 2 個

	// Carousel Template
	CarouselColumns []LinebotCarouselColumn `json:"carousel_columns,omitempty"`

	// Image Carousel Template
	ImageCarouselColumns []LinebotImageCarouselColumn `json:"image_carousel_columns,omitempty"`
}

// Carousel Column
type LinebotCarouselColumn struct {
	ThumbnailURL  string          `json:"thumbnail_url,omitempty"`
	ImageAspect   string          `json:"image_aspect,omitempty"`   // rectangle, square
	ImageSize     string          `json:"image_size,omitempty"`     // cover, contain
	ImageBgColor  string          `json:"image_bg_color,omitempty"` // #RRGGBB
	Title         string          `json:"title,omitempty"`
	Text          string          `json:"text"`
	DefaultAction *LinebotAction  `json:"default_action,omitempty"`
	Actions       []LinebotAction `json:"actions"`
}

// Image Carousel Column
type LinebotImageCarouselColumn struct {
	ImageURL string        `json:"image_url"`
	Action   LinebotAction `json:"action"`
}

// Action 結構
type LinebotAction struct {
	Type string `json:"type"` // message, postback, uri, datetimepicker, camera, cameraRoll, location

	// Message Action
	Label string `json:"label,omitempty"`
	Text  string `json:"text,omitempty"`

	// Postback Action
	Data        string `json:"data,omitempty"`
	DisplayText string `json:"display_text,omitempty"`

	// URI Action
	URI string `json:"uri,omitempty"`

	// Datetimepicker Action
	Mode    string `json:"mode,omitempty"`    // date, time, datetime
	Initial string `json:"initial,omitempty"` // YYYY-MM-DD, HH:mm, YYYY-MM-DDThh:mm
	Max     string `json:"max,omitempty"`
	Min     string `json:"min,omitempty"`
}

// Quick Reply
type LinebotQuickReply struct {
	Items []LinebotQuickReplyItem `json:"items"` // 最多 13 個
}

type LinebotQuickReplyItem struct {
	ImageURL string        `json:"image_url,omitempty"`
	Action   LinebotAction `json:"action"`
}

// Sender
type LinebotSender struct {
	Name    string `json:"name,omitempty"`
	IconURL string `json:"icon_url,omitempty"`
}

// Imagemap
type LinebotImagemapSize struct {
	Width  int `json:"width"`
	Height int `json:"height"`
}

type LinebotImagemapArea struct {
	Type    string               `json:"type"` // uri, message
	Area    LinebotImagemapCoord `json:"area"`
	LinkURI string               `json:"link_uri,omitempty"`
	Text    string               `json:"text,omitempty"`
}

type LinebotImagemapCoord struct {
	X      int `json:"x"`
	Y      int `json:"y"`
	Width  int `json:"width"`
	Height int `json:"height"`
}

// BuildMessage 自動判斷訊息類型並建構
func (r *LinebotRequest) BuildMessage() (linebot.SendingMessage, error) {
	var msg linebot.SendingMessage

	// 依參數判斷訊息類型
	switch {
	case r.ImageOriginalURL != "" && r.ImagePreviewURL != "":
		msg = linebot.NewImageMessage(r.ImageOriginalURL, r.ImagePreviewURL)

	case r.VideoOriginalURL != "" && r.VideoPreviewURL != "":
		msg = linebot.NewVideoMessage(r.VideoOriginalURL, r.VideoPreviewURL)

	case r.AudioOriginalURL != "" && r.AudioDuration > 0:
		msg = linebot.NewAudioMessage(r.AudioOriginalURL, r.AudioDuration)

	case r.LocationTitle != "" && r.LocationAddress != "":
		msg = linebot.NewLocationMessage(
			r.LocationTitle,
			r.LocationAddress,
			r.LocationLatitude,
			r.LocationLongitude,
		)

	case r.StickerPackageID != "" && r.StickerID != "":
		msg = linebot.NewStickerMessage(r.StickerPackageID, r.StickerID)

	case r.FlexAltText != "" && r.FlexContents != nil:
		return nil, fmt.Errorf("flex message requires manual construction")

	case r.TemplateAltText != "" && r.Template != nil:
		template, err := r.Template.Build()
		if err != nil {
			return nil, err
		}
		msg = linebot.NewTemplateMessage(r.TemplateAltText, template)

	case r.ImagemapBaseURL != "" && r.ImagemapAltText != "":
		return nil, fmt.Errorf("imagemap message requires manual construction")

	case r.Text != "":
		msg = linebot.NewTextMessage(r.Text)

	default:
		return nil, fmt.Errorf("no valid message parameters provided")
	}

	// 附加 Quick Reply
	if r.QuickReply != nil {
		items := make([]*linebot.QuickReplyButton, 0, len(r.QuickReply.Items))
		for _, item := range r.QuickReply.Items {
			action := buildQuickReplyAction(item.Action)
			btn := linebot.NewQuickReplyButton(item.ImageURL, action)
			items = append(items, btn)
		}
		msg = linebot.SendingMessage(msg).WithQuickReplies(&linebot.QuickReplyItems{Items: items})
	}

	// 附加 Sender
	if r.Sender != nil {
		msg = linebot.SendingMessage(msg).WithSender(&linebot.Sender{
			Name:    r.Sender.Name,
			IconURL: r.Sender.IconURL,
		})
	}

	return msg, nil
}

// Build Template
func (t *LinebotTemplate) Build() (linebot.Template, error) {
	switch {
	case len(t.ButtonsActions) > 0:
		actions := make([]linebot.TemplateAction, 0, len(t.ButtonsActions))
		for _, a := range t.ButtonsActions {
			actions = append(actions, buildAction(a))
		}
		return linebot.NewButtonsTemplate(
			t.ButtonsThumbnailURL,
			t.ButtonsTitle,
			t.ButtonsText,
			actions...,
		), nil

	case len(t.ConfirmActions) == 2:
		return linebot.NewConfirmTemplate(
			t.ConfirmText,
			buildAction(t.ConfirmActions[0]),
			buildAction(t.ConfirmActions[1]),
		), nil

	case len(t.CarouselColumns) > 0:
		columns := make([]*linebot.CarouselColumn, 0, len(t.CarouselColumns))
		for _, col := range t.CarouselColumns {
			actions := make([]linebot.TemplateAction, 0, len(col.Actions))
			for _, a := range col.Actions {
				actions = append(actions, buildAction(a))
			}
			column := linebot.NewCarouselColumn(
				col.ThumbnailURL,
				col.Title,
				col.Text,
				actions...,
			)
			columns = append(columns, column)
		}
		return linebot.NewCarouselTemplate(columns...), nil

	case len(t.ImageCarouselColumns) > 0:
		columns := make([]*linebot.ImageCarouselColumn, 0, len(t.ImageCarouselColumns))
		for _, col := range t.ImageCarouselColumns {
			column := linebot.NewImageCarouselColumn(
				col.ImageURL,
				buildAction(col.Action),
			)
			columns = append(columns, column)
		}
		return linebot.NewImageCarouselTemplate(columns...), nil

	default:
		return nil, fmt.Errorf("no valid template parameters provided")
	}
}

// buildAction 將 LinebotAction 轉換為 linebot.TemplateAction
func buildAction(a LinebotAction) linebot.TemplateAction {
	switch a.Type {
	case "message":
		return linebot.NewMessageAction(a.Label, a.Text)
	case "postback":
		return linebot.NewPostbackAction(a.Label, a.Data, a.Text, a.DisplayText, "", "")
	case "uri":
		return linebot.NewURIAction(a.Label, a.URI)
	case "datetimepicker":
		return linebot.NewDatetimePickerAction(a.Label, a.Data, a.Mode, a.Initial, a.Max, a.Min)
	default:
		return linebot.NewMessageAction(a.Label, a.Text)
	}
}

// buildQuickReplyAction 將 LinebotAction 轉換為 linebot.QuickReplyAction
func buildQuickReplyAction(a LinebotAction) linebot.QuickReplyAction {
	switch a.Type {
	case "message":
		return linebot.NewMessageAction(a.Label, a.Text)
	case "postback":
		return linebot.NewPostbackAction(a.Label, a.Data, a.Text, a.DisplayText, "", "")
	case "uri":
		return linebot.NewURIAction(a.Label, a.URI)
	case "datetimepicker":
		return linebot.NewDatetimePickerAction(a.Label, a.Data, a.Mode, a.Initial, a.Max, a.Min)
	case "camera":
		return linebot.NewCameraAction(a.Label)
	case "cameraRoll":
		return linebot.NewCameraRollAction(a.Label)
	case "location":
		return linebot.NewLocationAction(a.Label)
	default:
		return linebot.NewMessageAction(a.Label, a.Text)
	}
}
```
